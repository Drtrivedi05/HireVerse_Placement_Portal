{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TNP Dashboard | HireVerse</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    /* Sidebar & dashboard styles remain the same as previous version */
    body{background:#f4f6f8;font-family:Poppins,sans-serif;margin:0;padding:0;}
    
    .dashboard-container{margin-left:240px;padding:2rem;}
    .topbar{background:#fff;padding:1rem 2rem;border-bottom:1px solid #e3e3e3;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:900;box-shadow:0 2px 8px rgba(0,0,0,0.08);border-radius:12px;margin-bottom:1.2rem;}
    .topbar:hover{box-shadow:0 4px 16px rgba(0,0,0,0.16);transform:translateY(-2px) scale(1.01);}
    .dashboard-cards{display:flex;gap:1.5rem;margin-bottom:2rem;flex-wrap:wrap;}
    .dashboard-card{background:#fff;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.08);padding:1.5rem;flex:1 1 220px;min-width:220px;text-align:center;display:flex;flex-direction:column;align-items:center;justify-content:center;transition:box-shadow 0.2s,transform 0.2s;}
    .dashboard-card:hover{box-shadow:0 4px 16px rgba(0,0,0,0.16);transform:translateY(-4px) scale(1.03);}
    .dashboard-card .bi{font-size:2.2rem;color:#007bff;margin-bottom:0.5rem;}
    .dashboard-card h4{margin-bottom:0.5rem;font-size:1.2rem;color:#007bff;font-weight:600;}
    .dashboard-card p{font-size:2rem;font-weight:bold;margin:0;}
    .table-container{background:#fff;border-radius:12px;padding:1rem;box-shadow:0 2px 8px rgba(0,0,0,0.08);margin-bottom:2rem;}
    .table thead th{font-weight:600;color:black;}
    .section-title{font-size:1.3rem;font-weight:600;margin-bottom:1rem;color:#007bff;}
    .modal-content{border-radius:16px;border:none;}
    .modal-header{background:#007bff;color:#fff;border-bottom:none;border-radius:16px 16px 0 0;}
    .modal-footer{background:#f7f9fc;border-top:none;border-bottom-left-radius:16px;border-bottom-right-radius:16px;}
    .btn-secondary{border-radius:8px;background-color:#007bff;border:none;color:#fff;font-weight:500;transition:all 0.2s ease;}
    .btn-secondary:hover{background-color:#0056b3;transform:translateY(-2px);box-shadow:0 4px 10px rgba(0,123,255,0.3);}
    .modal-body img{width:100px;height:100px;object-fit:cover;margin-bottom:15px;}
    @media(max-width:768px){.dashboard-container{margin-left:0;padding:1rem;}.sidebar{width:100%;position:relative;}}
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar d-flex flex-column justify-content-between"
    style="
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        width: 240px;
        background: #ffffff;
        box-shadow: 2px 0 8px rgba(0,0,0,0.05);
        padding: 20px 0;
        z-index: 1000;
    ">

    <!-- Logo Section -->
    <div style="text-align: center; margin-bottom: 20px;">
      {% load static %}
      <img src="{% static 'assets/logo_main.png' %}" 
          alt="HireVerse Logo" 
          style="width: 180px; height: auto; object-fit: contain;">
    </div>

    <!-- Navigation Links -->
    <nav class="nav flex-column" style="padding: 0 15px; flex-grow: 1;">
      
      <a class="nav-link active" href="/tnpDashboard"
        style="background: #e9f5ff; color: #0056b3; font-weight: 600;
                font-size: 1.05rem; margin-bottom: 12px; padding: 10px 12px;
                border-radius: 8px; display: flex; align-items: center; 
                gap: 8px; text-decoration: none; transition: 0.2s;">
        <i class="bi bi-speedometer2 me-2"></i> TNP Dashboard
      </a>

      <a class="nav-link" href="/tnpProfile"
        style="color: #007bff; font-weight: 500; font-size: 1.05rem;
                margin-bottom: 12px; padding: 10px 12px; border-radius: 8px;
                display: flex; align-items: center; gap: 8px; text-decoration: none;
                transition: 0.2s;"
        onmouseover="this.style.backgroundColor='#e9f5ff'; this.style.color='#0056b3';"
        onmouseout="this.style.backgroundColor='transparent'; this.style.color='#007bff';">
        <i class="bi bi-person-circle me-2"></i> Profile
      </a>

      <a class="nav-link" href="/tnpAddMember"
        style="color: #007bff; font-weight: 500; font-size: 1.05rem;
                margin-bottom: 12px; padding: 10px 12px; border-radius: 8px;
                display: flex; align-items: center; gap: 8px; text-decoration: none;
                transition: 0.2s;"
        onmouseover="this.style.backgroundColor='#e9f5ff'; this.style.color='#0056b3';"
        onmouseout="this.style.backgroundColor='transparent'; this.style.color='#007bff';">
        <i class="bi bi-person-plus me-2"></i> Add Members
      </a>

      <a class="nav-link" href="/tnpViewData"
        style="color: #007bff; font-weight: 500; font-size: 1.05rem;
                margin-bottom: 12px; padding: 10px 12px; border-radius: 8px;
                display: flex; align-items: center; gap: 8px; text-decoration: none;
                transition: 0.2s;"
        onmouseover="this.style.backgroundColor='#e9f5ff'; this.style.color='#0056b3';"
        onmouseout="this.style.backgroundColor='transparent'; this.style.color='#007bff';">
        <i class="bi bi-eye me-2"></i> View Data
      </a>

      <a class="nav-link" href="/tnpReport"
        style="color: #007bff; font-weight: 500; font-size: 1.05rem;
                margin-bottom: 12px; padding: 10px 12px; border-radius: 8px;
                display: flex; align-items: center; gap: 8px; text-decoration: none;
                transition: 0.2s;"
        onmouseover="this.style.backgroundColor='#e9f5ff'; this.style.color='#0056b3';"
        onmouseout="this.style.backgroundColor='transparent'; this.style.color='#007bff';">
        <i class="bi bi-bar-chart me-2"></i> Reports
      </a>
    </nav>

    <!-- Logout Button -->
    <a class="nav-link" href="{% url 'logout' %}"
      style="
          color: #dc3545; 
          font-weight: 600; 
          font-size: 1.05rem; 
          padding: 10px 12px; 
          border-radius: 8px; 
          display: flex; align-items: center; gap: 8px;
          text-decoration: none; 
          transition: 0.2s; 
          border-top: 1px solid #f0f0f0; 
          justify-content: center;
          margin-top: auto;
      "
      onmouseover="this.style.backgroundColor='#ffe6e9'; this.style.color='#b02a37';"
      onmouseout="this.style.backgroundColor='transparent'; this.style.color='#dc3545';">
      <i class="bi bi-box-arrow-right me-2"></i> Logout
    </a>

  </div>


  <div class="dashboard-container">
    <div class="topbar"><h3>TNP Dashboard</h3></div>

    <!-- Cards -->
    <div class="dashboard-cards">
      <div class="dashboard-card"><i class="bi bi-person"></i><h4>Total Students</h4><p>{{ total_students }}</p></div>
      <div class="dashboard-card"><i class="bi bi-building"></i><h4>Companies</h4><p>{{ total_companies }}</p></div>
      <div class="dashboard-card"><i class="bi bi-award"></i><h4>Placed Students</h4><p>{{ placed_students }}</p></div>
      <div class="dashboard-card"><i class="bi bi-file-earmark-text"></i><h4>Reports</h4><p>0</p></div>
    </div>

    <!-- Students Table -->
    <h4 class="section-title">Recent Students</h4>
    <div class="table-container">
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-light">
            <tr><th>Name</th><th>Branch</th><th>Email</th><th>Status</th><th>Action</th></tr>
          </thead>
          <tbody>
            {% for student in recent_students %}
            <tr>
              <td>{{ student.STUDENT_NAME }}</td>
              <td>{{ student.STUDENT_BRANCH }}</td>
              <td>{{ student.STUDENT_EMAIL }}</td>
              <td><span class="badge bg-success">Active</span></td>
              <td><button class="btn btn-sm btn-primary" onclick="viewStudent({{ student.STUDENT_ID }})"><i class="bi bi-eye"></i> View</button></td>
            </tr>
            {% empty %}
            <tr><td colspan="5" class="text-center text-muted">No recent students found.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Jobs Table -->
    <h4 class="section-title">Recent Jobs</h4>
    <div class="table-container">
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-light">
            <tr><th>Company</th><th>Job Role</th><th>Salary(LPA)</th><th>Status</th><th>Action</th></tr>
          </thead>
          <tbody>
            {% for job in recent_jobs %}
            <tr>
              <td>{{ job.COMPANY.COMPANY_NAME }}</td>
              <td>{{ job.JOB_TITLE }}</td>
              <td>{{ job.JOB_SALARY }}</td>
              <td>
                {% if job.JOB_STATUS == "Open" %}
                  <span class="badge bg-success">Open</span>
                {% else %}
                  <span class="badge bg-secondary">Close</span>
                {% endif %}
              </td>
              <td><button class="btn btn-sm btn-primary" onclick="viewJob({{ job.JOB_ID }})"><i class="bi bi-eye"></i> View</button></td>
            </tr>
            {% empty %}
            <tr><td colspan="5" class="text-center text-muted">No recent jobs found.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="viewModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">Details</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="viewModalBody">Loading...</div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    function viewStudent(studentId){
      fetch(`/tnp/student-details/${studentId}/`).then(res=>res.json()).then(data=>{
        const modalBody=document.getElementById('viewModalBody');
        if(data.success){
          const s=data.student;
          modalBody.innerHTML=`
            <div class="text-center mb-3">
              <img src="${s.STUDENT_PROFILE_PHOTO || '/static/assets/default_profile.png'}" class="rounded-circle">
            </div>
            <h5 class="text-center mb-2">${s.STUDENT_NAME}</h5>
            <p><strong>Branch:</strong> ${s.STUDENT_BRANCH}</p>
            <p><strong>Email:</strong> ${s.STUDENT_EMAIL}</p>
            <p><strong>Phone:</strong> ${s.STUDENT_PHONE_NO}</p>
            <p><strong>Enrollment No:</strong> ${s.STUDENT_ENROLLMENT_NUMBER}</p>
            <p><strong>CGPA:</strong> ${s.STUDENT_CGPA}</p>
            <p><strong>Backlogs:</strong> ${s.STUDENT_BACKLOG}</p>
            <p><strong>Area of Interest:</strong> ${s.STUDENT_AREA_OF_INTEREST || '-'}</p>
            <p><strong>LinkedIn:</strong> <a href="${s.STUDENT_LINKEDIN_URL}" target="_blank">${s.STUDENT_LINKEDIN_URL || '-'}</a></p>
            <p><strong>GitHub:</strong> <a href="${s.STUDENT_GITHUB_LINK}" target="_blank">${s.STUDENT_GITHUB_LINK || '-'}</a></p>
            <p><strong>Portfolio:</strong> <a href="${s.STUDENT_PERSONAL_WEBSITE_PORTFOLIO}" target="_blank">${s.STUDENT_PERSONAL_WEBSITE_PORTFOLIO || '-'}</a></p>
          `;
        } else { modalBody.innerHTML="<p class='text-danger'>Student not found.</p>"; }
        new bootstrap.Modal(document.getElementById('viewModal')).show();
      });
    }

    function viewJob(jobId){
      fetch(`/tnp/company-details/${jobId}/`).then(res=>res.json()).then(data=>{
        const modalBody=document.getElementById('viewModalBody');
        if(data.success){
          const j=data.job;
          modalBody.innerHTML=`
            <h5 class="text-center mb-2">${j.JOB_TITLE}</h5>
            <p><strong>Company:</strong> ${j.COMPANY.COMPANY_NAME}</p>
            <p><strong>Description:</strong> ${j.JOB_DESCRIPTION}</p>
            <p><strong>Location:</strong> ${j.JOB_LOCATION}</p>
            <p><strong>Package:</strong> ${j.JOB_SALARY} LPA</p>
            <p><strong>Type:</strong> ${j.JOB_TYPE}</p>
            <p><strong>Status:</strong> ${j.JOB_STATUS}</p>
          `;
        } else { modalBody.innerHTML="<p class='text-danger'>Job not found.</p>"; }
        new bootstrap.Modal(document.getElementById('viewModal')).show();
      });
    }
  </script>
</body>
</html>
